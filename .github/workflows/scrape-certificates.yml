name: Scrape Certificati ‚Üí Render Auto-Deploy

on:
  schedule:
    - cron: '0 6 * * *'  # Daily 8AM CET
  workflow_dispatch:
    inputs:
      recent_days:
        description: 'Giorni recenti'
        default: '30'
        type: choice
        options: ['7','15','30','60']

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: üêç Python + Playwright
      uses: actions/setup-python@v5
      with: python-version: '3.11'
    
    - run: |
        pip install playwright pandas beautifulsoup4 lxml
        playwright install --with-deps chromium
        python certificates-scraper-ced-v15.py
    
    - name: ‚úÖ Verify 1739+ certificati
      run: |
        COUNT=$(python -c "import json;print(len(json.load(open('certificates-data.json'))))")
        echo "‚úÖ $COUNT certificati OK"
    
    - name: üöÄ COMMIT JSON ‚Üí Render auto-redeploy
      run: |
        git config user.name "Auto-deploy"
        git config user.email "actions@github.com"
        git add certificates-data.json
        git commit -m "Update: $COUNT certificati recenti CED" || echo "No changes"
        git push
